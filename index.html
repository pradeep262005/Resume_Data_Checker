<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Resume Field Finder (Gemini)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
</head>
<style>
body{
    font-size: larger;
    color: blanchedalmond;
    background-color: black;
}
#nav{
    display: flex;
    justify-content:center ;
    align-items: center;
    border: 5px solid rgb(240, 238, 234);
    margin:20px 20px 0 0;
}
#id{
    color:white;
    display:list-item;
    justify-content:center ;
    align-items: center;
}
</style>
<body>
    <div id="nav">
    <div><center>
        <h1>Know the Candidate</h1>
        <label for="resume">Upload your Resume (PDF)</label><br><br>
        <input type="file" id="resume" accept=".pdf"><br><br>
        <button onclick="find()">Send</button>
    </center>
    </div>
</div>
<div id="response" style="margin-top: 20px; white-space: pre-wrap;"></div>

   <script>
async function extractPDFText(file) {
  const reader = new FileReader();
  return new Promise((resolve, reject) => {
    reader.onload = async function () {
      const typedarray = new Uint8Array(reader.result);
      const pdf = await pdfjsLib.getDocument(typedarray).promise;
      let text = "";
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const strings = content.items.map(item => item.str);
        text += strings.join(" ") + "\n";
      }
      resolve(text);
    };
    reader.onerror = () => reject("Failed to read PDF file.");
    reader.readAsArrayBuffer(file);
  });
}

async function find() {
  const fileInput = document.getElementById("resume");
  const file = fileInput.files[0];

  if (!file || file.type !== "application/pdf") {
    alert("Please upload a PDF file.");
    return;
  }

  try {
    const pdfText = await extractPDFText(file);

    // WARNING: embedding API key in browser is insecure! Use server proxy in production.
    const MISTRAL_API_KEY = "vdmhyERh9yADL0RNkj8BxWc50jIP6cEn";

    // Build prompt
    const prompt = `Give details like role, technical skill, experiences, mail and phone in a proper ordered list format no any extra detail should be provided:\n\n${pdfText}`;

    const resp = await fetch("https://api.mistral.ai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${MISTRAL_API_KEY}`
      },
      body: JSON.stringify({
        model: "mistral-large-latest",
        messages: [
          { role: "user", content: prompt }
        ],
        // optional tuning:
        // max_tokens: 800,
        // temperature: 0.0
      })
    });

    const data = await resp.json();

    if (resp.ok) {
      // Mistral returns choices[].message.content
      const text = data?.choices?.[0]?.message?.content ?? JSON.stringify(data, null, 2);
      document.getElementById("response").innerText = text;
    } else {
      console.error("Mistral API error:", data);
      document.getElementById("response").innerText = "Error: " + (data.error?.message || JSON.stringify(data));
    }
  } catch (err) {
    console.error(err);
    document.getElementById("response").innerText = "Failed to process the resume.";
  }
}
</script>

</body>
</html>
